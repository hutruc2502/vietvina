<!doctype html><html lang="de"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Việt Vina Asian Kitchen – Vollständige Karte & Bestellung</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  .img-cover{object-fit:cover}
  button:active{transform:translateY(1px)}
  .opt-pill{border-width:1px;border-radius:9999px;padding:.25rem .5rem;font-size:.75rem}
  .opt-pill.active{background:#ecfdf5;border-color:#059669;color:#065f46}
</style>

<script>window.WHATSAPP_NUMBER="4917641545888";</script>
</head>
<body class="bg-gray-50 text-gray-900">
<header class="sticky top-0 z-40 bg-white/90 backdrop-blur border-b">
  <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-4">
    <img src="images/logo.jpg" alt="Logo" class="h-10 w-10 rounded" onerror="this.style.display='none'"/>
    <div><h1 class="text-xl font-semibold">Việt Vina Asian Kitchen</h1><p class="text-sm text-gray-600">Vietnamesische Küche – täglich frisch</p></div>
    <nav class="ml-auto flex items-center gap-3">
      <a href="#speisekarte" class="px-3 py-2 rounded-lg hover:bg-gray-100 text-sm">Speisekarte</a>
      <button id="openCartBtn" class="relative px-3 py-2 rounded-xl bg-emerald-600 text-white text-sm">Warenkorb <span id="cartCount" class="absolute -top-2 -right-2 text-[11px] bg-white text-emerald-700 border border-emerald-600 rounded-full px-1.5">0</span></button>
    </nav>
  </div>
</header>

<section class="max-w-6xl mx-auto px-4 mt-6">
<div class="mb-2 text-sm text-amber-700 bg-amber-50 border border-amber-200 rounded-xl px-4 py-2">Lieferung <b>ab 17:00 Uhr</b>. Für Lieferung: zuerst <b>PayPal</b> (an <span class="font-mono">trungdao@gmx.de</span>), dann WhatsApp senden. Abholung: Zahlung im Restaurant.</div>
<div class="mb-2 text-sm text-emerald-800 bg-emerald-50 border border-emerald-200 rounded-xl px-4 py-2">
  <b>Hinweis:</b> Abholung erhält <b>10&nbsp;% Rabatt</b> beim Selbstabholen. Lieferung: <b>+2&nbsp;€ Liefergebühr</b> bei Bestellungen <b>unter 25&nbsp;€</b> (Umkreis <b>5&nbsp;km</b>). Die Endsumme wird vom Restaurant bestätigt – hier wird <u>nicht automatisch</u> berechnet.
</div>
<div class="flex flex-wrap items-center gap-3">
<input id="searchInput" type="search" placeholder="Gericht suchen …" class="w-72 max-w-full rounded-xl border px-4 py-2"/>
<div class="flex gap-2 text-sm flex-wrap">
<button data-filter="all" class="filterBtn px-3 py-1.5 rounded-xl border bg-white hover:bg-gray-50">Alle</button><button data-filter="suppen" class="filterBtn px-3 py-1.5 rounded-xl border bg-white hover:bg-gray-50">Suppen</button><button data-filter="salate" class="filterBtn px-3 py-1.5 rounded-xl border bg-white hover:bg-gray-50">Salate</button><button data-filter="vorspeisen" class="filterBtn px-3 py-1.5 rounded-xl border bg-white hover:bg-gray-50">Vorspeisen</button><button data-filter="haupt" class="filterBtn px-3 py-1.5 rounded-xl border bg-white hover:bg-gray-50">Hauptgerichte</button><button data-filter="nudel" class="filterBtn px-3 py-1.5 rounded-xl border bg-white hover:bg-gray-50">Nudeln</button><button data-filter="reis" class="filterBtn px-3 py-1.5 rounded-xl border bg-white hover:bg-gray-50">Reis</button><button data-filter="pho" class="filterBtn px-3 py-1.5 rounded-xl border bg-white hover:bg-gray-50">Phở</button><button data-filter="reisnudeln" class="filterBtn px-3 py-1.5 rounded-xl border bg-white hover:bg-gray-50">Reisnudeln</button><button data-filter="bowls" class="filterBtn px-3 py-1.5 rounded-xl border bg-white hover:bg-gray-50">Bowls</button><button data-filter="spezial" class="filterBtn px-3 py-1.5 rounded-xl border bg-white hover:bg-gray-50">Spezialitäten</button><button data-filter="kids" class="filterBtn px-3 py-1.5 rounded-xl border bg-white hover:bg-gray-50">Kids</button><button data-filter="dessert" class="filterBtn px-3 py-1.5 rounded-xl border bg-white hover:bg-gray-50">Desserts</button><button data-filter="getraenke" class="filterBtn px-3 py-1.5 rounded-xl border bg-white hover:bg-gray-50">Getränke</button><button data-filter="kaffee" class="filterBtn px-3 py-1.5 rounded-xl border bg-white hover:bg-gray-50">Kaffee</button>
</div></div></section>

<section id="speisekarte" class="max-w-6xl mx-auto px-4 mt-4 mb-24"><div id="menuGrid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6"></div></section>

<aside id="cartDrawer" class="fixed inset-y-0 right-0 w-full sm:w-[440px] bg-white shadow-2xl translate-x-full transition-transform duration-300 z-50 flex flex-col">
<div class="p-4 border-b flex items-center justify-between"><h3 class="text-lg font-semibold">Warenkorb</h3><button id="closeCartBtn" class="p-2 rounded-lg hover:bg-gray-100">✕</button></div>
<div id="cartItems" class="flex-1 overflow-auto p-4 space-y-4"></div>
<div class="border-t p-4 space-y-3">
<div class="flex items-center justify-between text-sm"><span>Zwischensumme</span><span id="subtotal" class="font-medium">0 €</span></div>
<p class="text-xs text-gray-600 -mt-2">Die Zwischensumme enthält nur Speisen/Drinks. <b>Rabatt/Gebühr werden hier nicht automatisch berechnet.</b> Bitte wählen Sie unten die gewünschte Option – die Endsumme wird vom Restaurant bestätigt.</p>
<div class="grid sm:grid-cols-2 gap-3">
<input id="customerName" class="rounded-xl border px-3 py-2" placeholder="Name *"/>
<input id="customerPhone" class="rounded-xl border px-3 py-2" placeholder="Telefon *"/>
<input id="customerAddress" class="rounded-xl border px-3 py-2 sm:col-span-2" placeholder="Adresse (für Lieferung)"/>
<input id="customerNote" class="rounded-xl border px-3 py-2 sm:col-span-2" placeholder="Hinweise"/>
<div class="flex items-center gap-3 sm:col-span-2">
  <label class="flex items-center gap-2"><input type="radio" name="delivery" value="Abholung" checked/> Abholung (−10&nbsp;% Selbstabholung)</label>
  <label class="flex items-center gap-2"><input type="radio" name="delivery" value="Lieferung"/> Lieferung (&lt;25&nbsp;€ +2&nbsp;€, 5&nbsp;km)</label>
  <input id="desiredTime" type="time" class="ml-auto rounded-xl border px-3 py-2"/>
</div>
<div id="paypalArea" class="hidden sm:col-span-2 p-3 rounded-xl bg-blue-50 border border-blue-200 text-sm">
<div class="flex items-center justify-between gap-2"><div><div class="font-medium">Zahlung für Lieferung</div><div>PayPal an <span class="font-mono">trungdao@gmx.de</span>. Betrag = Zwischensumme (Rabatt/Gebühr werden vom Restaurant bestätigt).</div></div><button id="payWithPaypal" class="px-3 py-2 rounded-xl bg-blue-600 text-white">Mit PayPal bezahlen</button></div>
<label class="mt-2 block"><input type="checkbox" id="paypalDone" class="mr-2">Ich habe die PayPal-Zahlung abgeschlossen.</label>
</div></div>
<div class="grid sm:grid-cols-2 gap-3"><button id="sendWhatsApp" class="w-full py-3 rounded-xl bg-emerald-600 text-white font-medium">Bestellung per WhatsApp senden</button><button id="clearCart" class="w-full py-3 rounded-xl border">Warenkorb leeren</button></div>
<p class="text-xs text-gray-500">Abholung: 10&nbsp;% Rabatt vor Ort. Lieferung: +2&nbsp;€ unter 25&nbsp;€ innerhalb 5&nbsp;km. Endsumme folgt per Bestätigung.</p>
</div></aside>

<footer class="border-t bg-white"><div class="max-w-6xl mx-auto px-4 py-8 grid md:grid-cols-3 gap-4 text-sm">
<div><div class="font-semibold">Việt Vina Asian Kitchen</div><div>Adresse: Lindenthaler Str. 30, 04155 Leipzig</div></div>
<div><div class="font-semibold">Kontakt</div><div>WhatsApp: <a class="text-emerald-700" href="https://wa.me/4917641545888">0176 4154 5888</a></div></div>
<div class="text-gray-500">© <span id="year"></span> Việt Vina Asian Kitchen</div></div></footer>

<div id="upsellModal" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-[60]"><div class="bg-white rounded-2xl shadow-xl w-[92%] max-w-md p-5">
<h3 class="text-lg font-semibold">Möchten Sie Getränke hinzufügen?</h3>
<p class="text-sm text-gray-600 mt-1">Sparen Sie <b>0,50 €</b> pro Getränk – Aktionspreis wird automatisch berechnet.</p>
<div class="mt-3 grid grid-cols-2 gap-2 text-sm" id="upsellList"></div>
<div class="mt-4 flex items-center justify-end gap-2"><button id="upsellNo" class="px-3 py-2 rounded-xl border">Nein, danke</button><button id="upsellYes" class="px-3 py-2 rounded-xl bg-emerald-600 text-white">Hinzufügen & fortfahren</button></div>
</div></div>

<script>
const SHOP_WHATSAPP = '4917641545888'; // updated
const PAYPAL_EMAIL = 'trungdao@gmx.de';
const SHOP_NAME = 'Việt Vina Asian Kitchen';

/** GROUPED MENU **/
const MENU_DATA = [
  {"id":"sup-1","cat":"suppen","type":"single","name":"Garnelen-Suppe","price":4.9,"img":"images/Garnelen-suppe.avif"},
  {"id":"sup-2","cat":"suppen","type":"single","name":"Kokos-Suppe","price":4.9,"img":"images/Kokossuppe.jpg","desc":"Leicht scharf"},
  {"id":"sup-3","cat":"suppen","type":"single","name":"Miso-Suppe","price":4.9,"img":"images/miso-suppe.avif","ingredients":["Algen","Tofu","Dashi","Ingwer"]},

  {"id":"salat-4","cat":"salate","type":"group","name":"Wildkräutersalat","options":[
    {"key":"a","label":"mit Huhn","price":7.9},
    {"key":"b","label":"mit Garnelen","price":8.9},
    {"key":"c","label":"mit Tofu","price":7.0}
  ],"img":"images/wildkräutersalat.avif"},
  {"id":"salat-5","cat":"salate","type":"single","name":"Mango-Salat mit Garnelen","price":9.0,"img":"images/mangosalat-mit-garnelen.jpg"},
  {"id":"salat-6","cat":"salate","type":"single","name":"Kimchi-Salat","price":5.9,"img":"images/kimchi-salat.avif"},
  {"id":"salat-7","cat":"salate","type":"single","name":"Wakame-Salat","price":5.9,"img":"images/wakam-salat.avif"},

  {"id":"vor-8","cat":"vorspeisen","type":"group","name":"Sommerrollen (2 Stück)","desc":"Hausgemachte Sauce oder Schalottensauce (vegan)","options":[
    {"key":"a","label":"mit Huhn","price":5.9},
    {"key":"b","label":"mit Tempura-Garnelen","price":6.9},
    {"key":"c","label":"mit Tofu","price":5.0},
    {"key":"d","label":"Tempura-Avocado","price":5.9}
  ],"img":"images/Sommerollen.avif"},
  {"id":"vor-9","cat":"vorspeisen","type":"group","name":"Edamame","options":[
    {"key":"a","label":"Classic (gesiedet & gesalzen)","price":5.9},
    {"key":"b","label":"Spicy","price":6.5}
  ],"img":"images/Edamane.avif"},
  {"id":"vor-10","cat":"vorspeisen","type":"single","name":"Nem Hanoi (3 Stück)","price":6.9,"img":"images/nem-hanoi.svg","ingredients":["Garnelen","Hackfleisch","Glasnudeln","Morcheln","Gemüse"]},
  {"id":"vor-11","cat":"vorspeisen","type":"single","name":"Há cảo (Ha Cao) 4 Stück","price":6.9,"img":"images/ha-cao.avif","ingredients":["Garnelen","Teigtaschen"]},
  {"id":"vor-12","cat":"vorspeisen","type":"single","name":"Süßkartoffel-Pommes","price":5.9,"img":"images/Süßkartoffelpommes.avif"},
  {"id":"vor-13","cat":"vorspeisen","type":"single","name":"Saigon Mini-Frühlingsrollen (6 Stück)","price":5.9,"img":"images/saigon-mini-rollen.avif","desc":"vegetarische Füllung, süß-saure Sauce"},
  {"id":"vor-14","cat":"vorspeisen","type":"single","name":"Chicken Yakitori","price":5.9,"img":"images/Chicken-Yakitori.avif"},
  {"id":"vor-15","cat":"vorspeisen","type":"group","name":"Gyoza (6 Stück)","options":[
    {"key":"a","label":"Classic","price":6.9},
    {"key":"b","label":"Veggie","price":6.0}
  ],"img":"images/gyoza.svg"},
  {"id":"vor-16","cat":"vorspeisen","type":"single","name":"Tempura-Garnelen","price":5.9,"img":"images/garnele_tempura.svg"},

  {"id":"hg-17","cat":"haupt","type":"group","name":"Kokoscurry Sauce","options":[
    {"key":"a","label":"mit Huhn","price":11.9},
    {"key":"b","label":"mit gebackenem Huhn","price":12.9},
    {"key":"c","label":"mit Garnelen","price":12.9},
    {"key":"d","label":"mit gebackener Ente","price":13.9},
    {"key":"e","label":"mit Tofu","price":10.9}
  ],"img":"images/placeholder.svg"},
  {"id":"hg-18","cat":"haupt","type":"group","name":"Kokos Mango Sauce","options":[
    {"key":"a","label":"mit Huhn","price":11.9},
    {"key":"b","label":"mit gebackenem Huhn","price":12.9},
    {"key":"c","label":"mit Garnelen","price":12.9},
    {"key":"d","label":"mit gebackener Ente","price":13.9},
    {"key":"e","label":"mit Tofu","price":10.9}
  ],"img":"images/placeholder.svg"},
  {"id":"hg-19","cat":"haupt","type":"group","name":"Peanut Rice","options":[
    {"key":"a","label":"mit Huhn","price":11.9},
    {"key":"b","label":"mit gebackenem Huhn","price":12.9},
    {"key":"c","label":"mit Garnelen","price":12.9},
    {"key":"d","label":"mit gebackener Ente","price":13.9},
    {"key":"e","label":"mit Tofu","price":10.9}
  ],"img":"images/placeholder.svg"},
  {"id":"hg-20","cat":"haupt","type":"group","name":"Buddha’s Food","options":[
    {"key":"a","label":"mit Huhn","price":11.9},
    {"key":"b","label":"mit gebackenem Huhn","price":12.9},
    {"key":"c","label":"mit Garnelen","price":12.9},
    {"key":"d","label":"mit gebackener Ente","price":13.9},
    {"key":"e","label":"mit Tofu","price":10.9}
  ],"img":"images/placeholder.svg"},
  {"id":"hg-21","cat":"haupt","type":"group","name":"Süßsauce","options":[
    {"key":"a","label":"mit Huhn","price":11.9},
    {"key":"b","label":"mit gebackenem Huhn","price":12.9},
    {"key":"c","label":"mit Garnelen","price":12.9},
    {"key":"d","label":"mit gebackener Ente","price":13.9},
    {"key":"e","label":"mit Tofu","price":10.9}
  ],"img":"images/placeholder.svg"},
  {"id":"hg-22","cat":"haupt","type":"single","name":"Gebratenes Rind mit Zitronengras & Chili","price":13.9,"img":"images/placeholder.svg"},
  {"id":"hg-23","cat":"haupt","type":"single","name":"Rind „Lúc Lắc“ karamellisiert","price":13.9,"img":"images/bo-luc-lac.jpg"},
  {"id":"hg-24","cat":"haupt","type":"single","name":"Gebratenes Rind mit Gemüse","price":13.9,"img":"images/placeholder.svg"},
  {"id":"hg-25","cat":"haupt","type":"group","name":"Gebratenes Gemüse","options":[
    {"key":"a","label":"mit Huhn","price":11.9},
    {"key":"b","label":"mit gebackenem Huhn","price":12.9},
    {"key":"c","label":"mit Garnelen","price":12.9},
    {"key":"d","label":"mit gebackener Ente","price":13.9},
    {"key":"e","label":"mit Tofu","price":10.9}
  ],"img":"images/placeholder.svg"},

  {"id":"hg-26","cat":"nudel","type":"group","name":"Udon-Nudeln (gebraten)","options":[
    {"key":"a","label":"mit Huhn","price":12.9},
    {"key":"b","label":"mit gebackenem Huhn","price":13.9},
    {"key":"c","label":"mit Garnelen","price":13.9},
    {"key":"d","label":"mit gebackener Ente","price":14.9},
    {"key":"e","label":"mit Tofu","price":11.9}
  ],"img":"images/placeholder.svg"},
  {"id":"hg-29","cat":"nudel","type":"group","name":"China-Nudel (gebraten)","options":[
    {"key":"a","label":"mit Huhn","price":11.9},
    {"key":"b","label":"mit gebackenem Huhn","price":10.9},
    {"key":"c","label":"mit Garnelen","price":10.9},
    {"key":"d","label":"mit gebackener Ente","price":11.9},
    {"key":"e","label":"mit Tofu","price":8.0}
  ],"img":"images/placeholder.svg"},
  {"id":"hg-31","cat":"nudel","type":"group","name":"Gebratene Glasnudeln","options":[
    {"key":"a","label":"mit Huhn","price":9.9},
    {"key":"b","label":"mit gebackenem Huhn","price":10.9},
    {"key":"c","label":"mit Garnelen","price":10.9},
    {"key":"d","label":"mit gebackener Ente","price":11.9},
    {"key":"e","label":"mit Tofu","price":8.0}
  ],"img":"images/placeholder.svg"},

  {"id":"pho-27","cat":"pho","type":"group","name":"Phở","desc":"kräftige Rinderbrühe, Reisbandnudeln, Asiatische Kräuter","options":[
    {"key":"a","label":"mit Huhn","price":13.9},
    {"key":"b","label":"mit Rindfleisch","price":14.9},
    {"key":"c","label":"mit Tofu","price":11.9}
  ],"img":"images/placeholder.svg"},

  {"id":"bowl-28","cat":"bowls","type":"group","name":"Bowl","options":[
    {"key":"a","label":"mit Huhn (gebraten)","price":11.9},
    {"key":"b","label":"mit gebackenem Huhn","price":12.9},
    {"key":"c","label":"mit Tempura-Garnelen","price":12.9},
    {"key":"d","label":"mit Tofu","price":11.9},
    {"key":"e","label":"mit Rindfleisch","price":14.0}
  ],"img":"images/placeholder.svg"},

  {"id":"bunbo-32","cat":"reisnudeln","type":"group","name":"Bún bò Nam Bộ","options":[
    {"key":"a","label":"mit Huhn","price":11.9},
    {"key":"b","label":"mit Rindfleisch","price":13.9},
    {"key":"c","label":"mit Tofu","price":10.9},
    {"key":"d","label":"mit Garnelen","price":12.9}
  ],"img":"images/placeholder.svg"},

  {"id":"bun-33","cat":"suppen","type":"single","name":"Bún Chua Hải Sản Suppe","price":14.9,"img":"images/bun-chua-hai-san.jpg"},
  {"id":"bun-34","cat":"spezial","type":"single","name":"Bún Chả Hà Nội (Spezialität)","price":14.9,"img":"images/bun-cha-ha-noi.jpg"},
  {"id":"topokki-36","cat":"spezial","type":"single","name":"Tteokbokki (Topokki)","price":9.9,"img":"images/Topokki.jpg"},

  {"id":"kid-k1","cat":"kids","type":"single","name":"Süßkartoffel-Pommes mit gebackenem Fleisch","price":8.9,"img":"images/placeholder.svg"},
  {"id":"kid-k2","cat":"kids","type":"single","name":"Chicken Yakitori mit Tempura-Garnelen","price":8.9,"img":"images/Chicken-Yakitori.svg"},

  {"id":"des-35","cat":"dessert","type":"single","name":"Gebackene Banane","price":5.9,"img":"images/placeholder.svg"},
  {"id":"des-36","cat":"dessert","type":"single","name":"Mochi","price":5.9,"img":"images/placeholder.svg"},
  {"id":"des-37","cat":"dessert","type":"single","name":"Sesambällchen","price":5.9,"img":"images/placeholder.svg"},

  {"id":"drinks","cat":"getraenke","type":"list","name":"Getränke","items":[
    {"id":"dr-cola","name":"Cola 0,3l","price":2.5},
    {"id":"dr-fanta","name":"Fanta 0,3l","price":2.5},
    {"id":"dr-sprite","name":"Sprite 0,3l","price":2.5},
    {"id":"dr-limette-minze","name":"Limette-Minze","price":4.5},
    {"id":"dr-zitrone-erdbeer","name":"Zitrone-Erdbeer","price":4.5},
    {"id":"dr-yogurt-mango","name":"Mango Joghurt","price":4.5},
    {"id":"dr-yogurt-avocado","name":"Avocado Joghurt","price":4.5},
    {"id":"dr-yogurt-erdbeer","name":"Erdbeer Joghurt","price":4.5},
    {"id":"dr-asahi","name":"Asahi Bier","price":3.0},
    {"id":"dr-hefeweizen","name":"Hefeweizen","price":2.9},
    {"id":"dr-rotwein","name":"Rotwein","price":4.0},
    {"id":"dr-weisswein","name":"Weißwein","price":4.0},
    {"id":"dr-lychee","name":"Lychee 250ml","price":3.0},
    {"id":"dr-guave","name":"Guave 250ml","price":3.0}
  ],"img":"images/placeholder.svg"},

  {"id":"coffee","cat":"kaffee","type":"list","name":"Kaffee","items":[
    {"id":"cf-l1","name":"Cà phê sữa đá (Cafe Sua Dua)","price":3.5},
    {"id":"cf-l2","name":"Cà phê sữa đặc (Cafe Sua Dac)","price":3.5}
  ],"img":"images/placeholder.svg"}
];

const $ = (s, r=document)=>r.querySelector(s);
const $$=(s,r=document)=>Array.from(r.querySelectorAll(s));
const money=n=>`${n.toFixed(2)} €`;

const grid = $('#menuGrid');
const searchInput=$('#searchInput');
const filterBtns=$$('.filterBtn');
let activeFilter='all';

function renderMenu(items){
  grid.innerHTML='';
  items.forEach(i=>{
    const c=document.createElement('div');
    c.className='bg-white rounded-2xl shadow-sm overflow-hidden flex flex-col';
    const headerImg = `<div class="h-44 overflow-hidden"><img src="${i.img||'images/placeholder.svg'}" alt="${i.name}" class="w-full h-full img-cover" onerror="this.src='images/placeholder.svg'"/></div>`;
    let body = `<div class="p-4 flex-1 flex flex-col"><div class="flex items-start justify-between gap-3"><h3 class="font-semibold">${i.name}</h3>`;

    if(i.type==='single'){
      body += `<span class="text-emerald-700 font-semibold">${money(i.price)}</span></div>`;
      body += i.desc?`<p class='text-sm text-gray-600 mt-1'>${i.desc}</p>`:'';
      body += i.ingredients?.length?`<div class='mt-3 text-xs text-gray-700'><span class='font-medium'>Zutaten:</span> <span>${i.ingredients.join(', ')}</span></div>`:'';
      body += `<div class="mt-auto pt-4 flex items-center gap-2">
        <input type="number" min="1" value="1" class="qtyInput w-16 rounded-xl border px-2 py-1"/>
        <button data-id="${i.id}" class="addBtn px-3 py-2 rounded-xl bg-emerald-600 text-white text-sm">In den Warenkorb</button>
      </div>`;
    }
    else if(i.type==='group'){
      body += `<span class="text-emerald-700 font-semibold">variabel</span></div>`;
      if(i.desc) body += `<p class='text-sm text-gray-600 mt-1'>${i.desc}</p>`;
      // option pills
      body += `<div class="mt-2 flex flex-wrap gap-2 text-xs">`;
      i.options.forEach((opt,idx)=>{
        body += `<button class="opt-pill ${idx===0?'active':''}" data-opt-key="${opt.key}" data-price="${opt.price}">${opt.key}) ${opt.label} — ${money(opt.price)}</button>`;
      });
      body += `</div>`;
      body += `<div class="mt-auto pt-4 flex items-center gap-2">
        <input type="number" min="1" value="1" class="qtyInput w-16 rounded-xl border px-2 py-1"/>
        <button data-id="${i.id}" class="addGroupBtn px-3 py-2 rounded-xl bg-emerald-600 text-white text-sm">In den Warenkorb</button>
      </div>`;
    }
    else if(i.type==='list'){
      body += `<span class="text-emerald-700 font-semibold">—</span></div>`;
      body += `<div class="mt-2 space-y-2">`;
      i.items.forEach(child=>{
        body += `<div class="flex items-center justify-between gap-2 border rounded-xl px-3 py-2">
          <div class="text-sm">${child.name}</div>
          <div class="flex items-center gap-3">
            <div class="font-medium">${money(child.price)}</div>
            <button data-id="${child.id}" data-parent="${i.id}" class="addListBtn px-2 py-1 rounded-lg bg-emerald-600 text-white text-xs">+</button>
          </div>
        </div>`;
      });
      body += `</div>`;
    }

    body += `</div>`;
    c.innerHTML = headerImg + body;
    grid.appendChild(c);

    // attach handlers
    if(i.type==='single'){
      c.querySelector('.addBtn').addEventListener('click',e=>{
        const qty=parseInt(c.querySelector('.qtyInput').value||'1',10);
        addToCart(i.id, qty, i.price, null, i.name);
        openCart();
      });
    }
    if(i.type==='group'){
      c.querySelectorAll('.opt-pill').forEach(btn=>{
        btn.addEventListener('click',()=>{
          c.querySelectorAll('.opt-pill').forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
        })
      });
      c.querySelector('.addGroupBtn').addEventListener('click',()=>{
        const qty=parseInt(c.querySelector('.qtyInput').value||'1',10);
        const active=c.querySelector('.opt-pill.active');
        const optKey=active?.getAttribute('data-opt-key');
        const price=parseFloat(active?.getAttribute('data-price')||'0');
        const label=i.options.find(o=>o.key===optKey)?.label||'';
        addToCart(i.id+'-'+optKey, qty, price, `(${optKey}) ${label}`, i.name);
        openCart();
      });
    }
    if(i.type==='list'){
      c.querySelectorAll('.addListBtn').forEach(btn=>{
        btn.addEventListener('click',()=>{
          const cid=btn.getAttribute('data-id');
          const child=i.items.find(x=>x.id===cid);
          if(child) addToCart(child.id,1,child.price,null,child.name);
          openCart();
        });
      });
    }
  });
}

function applyFilter(){
  const q=(searchInput.value||'').toLowerCase().trim();
  const f=activeFilter;
  const data=MENU_DATA.filter(i=>{
    // for search across names, options, and child items
    const haystack = [
      i.name||'',
      (i.desc||''),
      ...(i.options?.map(o=>o.label)||[]),
      ...(i.items?.map(ch=>ch.name)||[])
    ].join(' ').toLowerCase();
    const hitQ=!q || haystack.includes(q) || (i.cat||'').includes(q);
    const hitF=f==='all'||i.cat===f;
    return hitQ && hitF;
  });
  renderMenu(data);
}
searchInput.addEventListener('input',applyFilter);
filterBtns.forEach(b=>b.addEventListener('click',()=>{
  activeFilter=b.getAttribute('data-filter');
  filterBtns.forEach(x=>x.classList.remove('bg-emerald-50','border-emerald-200'));
  b.classList.add('bg-emerald-50','border-emerald-200');
  applyFilter();
}));

const state={cart:[]};
function addToCart(id,qty=1,priceOverride=null,note=null,baseName=null){
  const name = baseName ? `${baseName}${note? ' ' + note : ''}` : (note? note : id);
  const ex=state.cart.find(x=>x.id===id && x.price===(priceOverride) && x.name===name);
  if(ex) ex.qty+=qty; else state.cart.push({id,name,price:priceOverride,qty});
  updateCartUI();
}
function removeFromCart(idx){ state.cart.splice(idx,1); updateCartUI(); }
function changeQty(idx,qty){ state.cart[idx].qty=Math.max(1,qty); updateCartUI(); }
function subtotal(){return state.cart.reduce((s,x)=>s+x.price*x.qty,0)}

function updateCartUI(){
  const list=$('#cartItems'); list.innerHTML='';
  state.cart.forEach((it,idx)=>{
    const row=document.createElement('div');
    row.className='flex items-center gap-3';
    row.innerHTML=`<div class="flex-1"><div class="font-medium">${it.name}</div><div class="text-xs text-gray-600">${money(it.price)} × </div></div>
    <div class="flex items-center gap-2"><input type="number" min="1" value="${it.qty}" data-idx="${idx}" class="cartQty w-16 rounded-xl border px-2 py-1"/><button class="delBtn px-2 py-1 text-sm rounded-lg border">Entfernen</button></div>`;
    list.appendChild(row);
  });
  $$('.cartQty',list).forEach(inp=>inp.addEventListener('input',e=>{ const i=parseInt(e.currentTarget.getAttribute('data-idx'),10); const qty=parseInt(e.currentTarget.value||'1',10); changeQty(i,qty); }));
  $$('.delBtn',list).forEach((btn,idx)=>btn.addEventListener('click',()=>removeFromCart(idx)));
  $('#subtotal').textContent=money(subtotal());
  $('#cartCount').textContent=state.cart.reduce((s,x)=>s+x.qty,0);
  const delivery=document.querySelector('input[name="delivery"]:checked')?.value||'Abholung';
  $('#paypalArea').classList.toggle('hidden',delivery!=='Lieferung');
}

function openCart(){$('#cartDrawer').classList.remove('translate-x-full');}
document.getElementById('openCartBtn').addEventListener('click',openCart);
document.getElementById('closeCartBtn').addEventListener('click',()=>$('#cartDrawer').classList.add('translate-x-full'));

function buildPayPalUrl(){ const amount=subtotal().toFixed(2); const item=encodeURIComponent('Essensbestellung ' + SHOP_NAME); return `https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&business=${encodeURIComponent(PAYPAL_EMAIL)}&item_name=${item}&amount=${amount}&currency_code=EUR`; }
document.getElementById('payWithPaypal').addEventListener('click',()=>{ if(state.cart.length===0){alert('Bitte Gerichte hinzufügen.');return;} const t=($('#desiredTime').value||'').trim(); if(t && t<'17:00'){alert('Lieferung ab 17:00 Uhr.'); return;} window.open(buildPayPalUrl(),'_blank'); });

function buildWhatsAppText(){
  const name=$('#customerName').value.trim();
  const phone=$('#customerPhone').value.trim();
  const addr=$('#customerAddress').value.trim();
  const note=$('#customerNote').value.trim();
  const time=$('#desiredTime').value.trim();
  const delivery=document.querySelector('input[name="delivery"]:checked')?.value||'Abholung';
  const lines=[];
  lines.push('*NEUE BESTELLUNG* – ' + SHOP_NAME);
  lines.push('');
  state.cart.forEach(x=>lines.push(`• ${x.name} × ${x.qty} — ${money(x.price*x.qty)}`));
  lines.push(`Zwischensumme: ${money(subtotal())}`);
  lines.push('');
  lines.push('*Kundendaten:*');
  lines.push(`Name: ${name||'-'}`);
  lines.push(`Telefon: ${phone||'-'}`);
  lines.push(`Art: ${delivery}`);
  if(addr)lines.push(`Adresse: ${addr}`);
  if(time)lines.push(`Wunschzeit: ${time}`);
  if(delivery==='Lieferung'){
    lines.push('*Zahlungsart:* PayPal (an ' + PAYPAL_EMAIL + ')');
    lines.push('Hinweis Lieferung: Unter 25 € +2 € Liefergebühr (5 km). Endsumme wird vom Restaurant bestätigt.');
    if($('#paypalDone').checked)lines.push('Zahlung bestätigt vom Kunden.');
  } else {
    lines.push('*Zahlungsart:* Zahlung im Restaurant (Abholung)');
    lines.push('Hinweis Abholung: 10 % Rabatt beim Selbstabholen. Endsumme wird vor Ort bestätigt.');
  }
  if(note){
    lines.push('');
    lines.push('Hinweise:');
    lines.push(note);
  }
  return encodeURIComponent(lines.join('\n'));
}

function performSend(){ window.open(`https://wa.me/${SHOP_WHATSAPP}?text=${buildWhatsAppText()}`,'_blank'); }

// Upsell: build drink list from MENU_DATA automatically (list type under getraenke)
const DRINK_IDS = (()=>{
  const list = MENU_DATA.find(x=>x.cat==='getraenke' && x.type==='list');
  return list ? list.items.map(x=>x.id) : [];
})();
const DRINK_DISCOUNT=0.50;

function getDrinkById(id){
  const list = MENU_DATA.find(x=>x.cat==='getraenke' && x.type==='list');
  if(!list) return null;
  return list.items.find(x=>x.id===id) || null;
}
function cartHasDrinks(){
  return state.cart.some(x=>DRINK_IDS.includes(x.id));
}

function openUpsell(){
  const m=document.getElementById('upsellModal');
  const list=document.getElementById('upsellList');
  list.innerHTML='';
  DRINK_IDS.forEach(id=>{
    const it=getDrinkById(id);
    if(!it) return;
    const price=Math.max(0,(it.price-DRINK_DISCOUNT)).toFixed(2);
    const row=document.createElement('label');
    row.className='border rounded-xl px-3 py-2 flex items-center gap-2';
    row.innerHTML=`<input type="checkbox" value="${id}" class="drinkPick"> <div class="flex-1">${it.name}</div><div class="font-medium">${price} €</div>`;
    list.appendChild(row);
  });
  m.classList.remove('hidden'); m.classList.add('flex');
}
function closeUpsell(){const m=document.getElementById('upsellModal'); m.classList.add('hidden'); m.classList.remove('flex');}

function attemptCheckout(){
  const name=$('#customerName').value.trim();
  const phone=$('#customerPhone').value.trim();
  const delivery=document.querySelector("input[name='delivery']:checked")?.value||'Abholung';
  const t=($('#desiredTime').value||'').trim();
  if(!name||!phone||state.cart.length===0){alert('Bitte Name/Telefon und mindestens ein Gericht.');return;}
  if(delivery==='Lieferung'){
    if(t && t<'17:00'){alert('Lieferung ab 17:00 Uhr.');return;}
    if(!$('#paypalDone').checked){
      if(confirm('Bitte zuerst PayPal bezahlen. Jetzt zu PayPal?')) window.open(buildPayPalUrl(),'_blank');
      return;
    }
  }
  if(!cartHasDrinks()){openUpsell();return;}
  performSend();
}

document.getElementById('upsellNo').addEventListener('click',()=>{closeUpsell();performSend();});
document.getElementById('upsellYes').addEventListener('click',()=>{
  const picks=Array.from(document.querySelectorAll('.drinkPick:checked')).map(i=>i.value);
  picks.forEach(id=>{
    const base=getDrinkById(id);
    if(base) addToCart(id,1,Math.max(0,base.price-DRINK_DISCOUNT),'(Aktionspreis -0,50 €)', base.name);
  });
  closeUpsell(); performSend();
});

(function(){
  const btn=document.getElementById('sendWhatsApp');
  const clone=btn.cloneNode(true);
  btn.parentNode.replaceChild(clone,btn);
  clone.addEventListener('click',attemptCheckout);
})();

$$("input[name='delivery']").forEach(r=>r.addEventListener('change',updateCartUI));
document.getElementById('year')?.textContent && (document.getElementById('year').textContent=new Date().getFullYear());
function init(){ applyFilter(); updateCartUI(); }
init();
</script>

<script>
(function() {
  function textOf(el){ return (el.textContent||"").trim().toLowerCase(); }
  function bindUpsellOnWhatsApp(){
    var nodes = Array.from(document.querySelectorAll('button,a'));
    nodes.forEach(function(n){
      var t = textOf(n);
      if(t.includes('bestellung per whatsapp senden')){
        if(n.__upsellBound) return;
        n.__upsellBound = true;
        n.addEventListener('click', function(ev){
          try{
            if(typeof attemptCheckout==='function'){
              ev.preventDefault();
              attemptCheckout();
            }
          }catch(e){}
        }, true);
      }
    });
  }
  if(document.readyState==='loading'){
    document.addEventListener('DOMContentLoaded', bindUpsellOnWhatsApp);
  } else {
    bindUpsellOnWhatsApp();
  }
})();
</script>

</body></html>
